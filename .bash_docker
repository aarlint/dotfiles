#!/bin/bash

export DOCKER_REPO_PREFIX=benmatselby

del_stopped(){
	local name=$1
	local state
	state=$(docker inspect --format "{{.State.Running}}" "$name" 2>/dev/null)

	if [[ "$state" == "false" ]]; then
		docker rm "$name"
	fi
}

precis() {
    docker run \
        --rm \
        -t \
        -eVSTS_ACCOUNT \
        -eVSTS_PROJECT \
        -eVSTS_TEAM \
        -eVSTS_TOKEN \
        -eTRAVIS_CI_TOKEN \
        -eTRAVIS_CI_OWNER \
        -eGITHUB_TOKEN \
        -eGITHUB_OWNER \
        -v "${HOME}/.precis":/root/.precis \
        --name precis \
        ${DOCKER_REPO_PREFIX}/precis "$@"
}
frost() {
    docker run \
        --rm \
        -t \
        -eAZURE_DEVOPS_ACCOUNT \
        -eAZURE_DEVOPS_PROJECT \
        -eAZURE_DEVOPS_TEAM \
        -eAZURE_DEVOPS_TOKEN \
        -eTRAVIS_CI_TOKEN \
        -eTRAVIS_CI_OWNER \
        -eJENKINS_URL \
        -eJENKINS_USERNAME \
        -eJENKINS_PASSWORD \
        -eJENKINS_VIEW \
        ${DOCKER_REPO_PREFIX}/frost "$@"
}
donny() {
    docker run \
        --rm \
        -t \
        -eAZURE_DEVOPS_ACCOUNT \
        -eAZURE_DEVOPS_PROJECT \
        -eAZURE_DEVOPS_TEAM \
        -eAZURE_DEVOPS_TOKEN \
        ${DOCKER_REPO_PREFIX}/donny "$@"
}
trello() {
    docker run \
        --rm \
        -t \
        -eTRELLO_CLI_KEY \
        -eTRELLO_CLI_SECRET \
        ${DOCKER_REPO_PREFIX}/trello-cli "$@"
}
crime() {
    docker run --rm ${DOCKER_REPO_PREFIX}/uk-crime "$@"
}
clisplattr() {
    docker run \
        -t \
        --sig-proxy \
        --rm \
        -v "${HOME}/.clisplattr":/root/.clisplattr \
        ${DOCKER_REPO_PREFIX}/clisplattr "$@"
}
baldrick() {
    docker run \
        -d \
        --rm \
        -eBALDRICK_SLACK_TOKEN \
        -eBALDRICK_JENKINS_URL \
        ${DOCKER_REPO_PREFIX}/baldrick
}
gaudit() {
    docker run --rm -t \
        -eGITHUB_TOKEN="${GITHUB_TOKEN}" \
        jess/audit "$@"
}
travis() {
    docker run --rm -it \
        -v "${HOME}/.travis:/root/.travis" \
        -v "$(pwd):/usr/src/repo" \
        --workdir /usr/src/repo \
        --log-driver none \
        -eTRAVIS_TOKEN="${TRAVIS_CI_TOKEN}" \
        jess/travis "$@"
}
udict() {
    docker run --rm -t jess/udict "$@"
}


jenkins() {
    del_stopped jenkins
    docker run -d -p 8080:8080 \
        -v "$HOME/.jenkins":/var/jenkins_home \
        --name=jenkins \
        jenkins/jenkins
}
